# PSI - Private Set Intersection
Курсовая работа студентов группы 3234к Феоктистов С. А. Галахов К. В. Прибыткин И. А.

## Описание
Проект реализует протокол приватного пересечения множеств (Private Set Intersection, PSI), который позволяет двум сторонам (отправителю и получателю) находить пересечение их множеств без раскрытия элементов, не входящих в пересечение.

В основе реализации используются следующие криптографические примитивы и подходы:
- Гомоморфное шифрование (библиотека TenSEAL)
- Хеширование с использованием алгоритма MurmurHash3 (mmh3)
- Кукушкино хеширование (Cuckoo Hashing) для стороны клиента
- Простое хеширование (Simple Hashing) для стороны сервера
- Полиномиальное представление множеств
- Оконный метод для эффективного возведения в степень

## Архитектура проекта

Проект состоит из следующих основных компонентов:

### Основные модули
- `client_logic.py` - логика клиента (получателя)
- `server_logic.py` - логика сервера (отправителя)
- `hashing.py` - реализация алгоритмов хеширования
- `utils.py` - вспомогательные функции
- `data_generator.py` - генератор тестовых данных
- `api.py` - веб-интерфейс на FastAPI
- `main.py` - консольный запуск и демонстрация работы протокола

### Конфигурация
- `config.yaml` - основные параметры алгоритма
- `config.py` - загрузка и расчет параметров

## Требования
- Python 3.11 или выше
- Poetry (для управления зависимостями)

## Установка
1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/suai_term_psi.git
cd suai_term_psi
```

2. Установите зависимости с помощью Poetry:
```bash
poetry install
```

Основные зависимости:
- mmh3 - реализация MurmurHash3
- tenseal - гомоморфное шифрование
- fastecdsa - эллиптические кривые
- numpy - для работы с массивами и вычислений
- fastapi, uvicorn, jinja2 - для веб-интерфейса

## Запуск

### Веб-интерфейс
Запустите FastAPI сервер с помощью команды:
```bash
poetry run python api.py
```

После запуска сервера откройте в браузере адрес: http://localhost:8000

### Запуск из командной строки
Для запуска алгоритма PSI непосредственно из командной строки:
```bash
poetry run python main.py
```

## Использование веб-интерфейса

Веб-интерфейс предоставляет три способа работы с PSI:

1. **Ручной ввод**: 
   - Введите элементы множеств через запятую в соответствующие поля
   - Нажмите кнопку "Вычислить пересечение"

2. **Загрузка файлов**: 
   - Загрузите файлы, содержащие элементы множеств (по одному числу в каждой строке)
   - Для загрузки можно использовать собственные файлы или выбрать опцию "Использовать файлы по умолчанию"

3. **Тестовые данные**: 
   - Нажмите кнопку "Сгенерировать тестовые множества"
   - Система автоматически создаст тестовые данные согласно параметрам из config.yaml

## Параметры алгоритма

Конфигурация алгоритма выполняется в файле `config.yaml`:
- `sender_size` - размер множества отправителя (по умолчанию 32768)
- `receiver_size` - размер множества получателя (по умолчанию 3214)
- `intersection_size` - размер пересечения (по умолчанию 2000)
- `hash_seeds` - сиды для хеш-функций
- `output_bits` - количество битов для хеширования
- `plain_modulus` - модуль для операций с открытым текстом
- `poly_modulus_degree` - степень полиномиального модуля для BFV-схемы
- `alpha` - количество мини-корзин
- `ell` - параметр оконного метода

## Алгоритм работы PSI

1. **Предварительная обработка (сервер):**
   - Хеширование элементов с использованием Simple Hashing
   - Разделение корзин на миникорзины
   - Вычисление коэффициентов полиномов для каждой миникорзины

2. **Генерация запроса (клиент):**
   - Хеширование элементов с использованием Cuckoo Hashing
   - Применение оконного метода к элементам хештаблицы
   - Шифрование с использованием гомоморфного шифрования BFV

3. **Обработка запроса (сервер):**
   - Десериализация и восстановление шифротекстов
   - Восстановление недостающих степеней
   - Вычисление скалярных произведений с коэффициентами полиномов

4. **Формирование ответа (клиент):**
   - Расшифровка ответа сервера
   - Извлечение нулевых значений
   - Восстановление элементов пересечения

## Безопасность

Безопасность протокола основана на:
- Гомоморфном шифровании с использованием схемы BFV
- Параметрах хеширования, обеспечивающих низкую вероятность коллизий
- Расчете размера корзин для обеспечения заданного уровня безопасности
